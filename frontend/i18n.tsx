import { createContext, useContext, useEffect, useMemo, useState, ReactNode } from 'react';

type Language = 'en' | 'ur';

type TranslationMap = Record<string, string>;

const translations: Record<Language, TranslationMap> = {
  en: {
    'language.toggle': 'اردو',
    'language.selectTitle': 'Select Your Language',
    'language.selectSubtitle': 'Choose your preferred language',
    'language.englishDescription': 'Continue in English',
    'language.urduDescription': 'اردو میں جاری رکھیں',
    'language.continue': 'Continue',
    'home.promo.title': 'Azka Aqeel, Get a 30% DISCOUNT on Your Next Car Ride. Book Now!',
    'home.promo.subtitle': 'Limited time offer for you',
    'home.location.pickupLabel': 'Pickup location',
    'home.location.dropoffLabel': 'Dropoff location',
    'home.location.skip': 'Skip to Rent',
    'home.locateMe': 'Locate me',
    'nav.ride': 'Ride',
    'nav.delivery': 'Delivery',
    'nav.shops': 'Shops',
    'location.recent': 'Recent',
    'location.map': 'Map',
    'location.area': 'Area',
    'location.useCurrent': 'Use Current Location',
    'location.savedAddresses': 'Saved Addresses',
    'location.home': 'Home',
    'location.work': 'Work',
    'location.addNew': 'Add New Address',
    'location.recentLocations': 'Recent Locations',
    'location.currentLocation': 'Current Location',
    'location.searchPlaceholder': 'Pick Up',
    'location.from': 'From',
    'location.to': 'To',
    'location.areas.karachi': 'Karachi',
    'location.areas.surjaniTown': 'Surjani Town',
    'location.areas.newKarachi': 'New Karachi',
    'location.areas.northNazimabad': 'North Nazimabad',
    'location.areas.fbArea': 'FB Area',
    'location.areas.gulshanMaymar': 'Gulshan-e-Maymar',
    'location.areas.sohrabGoth': 'Sohrab Goth',
    'location.areas.scheme33': 'Scheme 33',
    'location.areas.gulistanJohar': 'Gulistan-e-Johar',
    'location.areas.malirAirport': 'Malir & Airport',
    'location.areas.landhi': 'Landhi',
    'location.areas.shahFaisalTown': 'Shah Faisal Town',
    'location.areas.korangi': 'Korangi',
    'location.areas.paf': 'PAF',
    'location.areas.mehmoodabad': 'Mehmoodabad',
    'location.areas.qayyumabad': 'Qayyumabad',
    'location.recent.fastUniversity': 'FAST University, Karachi',
    'location.recent.centaurusMall': 'Centaurus Mall, Islamabad',
    'location.recent.jinnahSuperMarket': 'Jinnah Super Market, Karachi',
    'parcel.title': 'Parcel Details',
    'parcel.deliveryRoute': 'Delivery Route',
    'parcel.parcelInfo': 'Parcel Information',
    'parcel.weight': 'Weight (kg)',
    'parcel.weightPlaceholder': 'e.g., 2.5',
    'parcel.dimensions': 'Dimensions (L x W x H cm)',
    'parcel.dimensionsPlaceholder': 'e.g., 30 x 20 x 15',
    'parcel.description': 'Description',
    'parcel.descriptionPlaceholder': "What's in the package?",
    'parcel.recipientDetails': 'Recipient Details',
    'parcel.name': 'Name',
    'parcel.namePlaceholder': "Recipient's full name",
    'parcel.phone': 'Phone Number',
    'parcel.phonePlaceholder': '03XX-XXXXXXX',
    'parcel.cod': 'Cash on Delivery',
    'parcel.codDesc': 'Collect payment from recipient',
    'parcel.codAmount': 'Amount to Collect (Rs)',
    'parcel.codAmountPlaceholder': 'e.g., 5000',
    'parcel.placeOrder': 'Place Order',
    'parcel.required': 'Please fill in all required fields',
    'shops.nearby': 'Nearby Shops',
    'shops.searchPlaceholder': 'Search for shops or products',
    'shops.popular': 'Popular Near You',
    'shops.orderAgain': 'Order Again',
    'shops.categories.groceries': 'Groceries',
    'shops.categories.pharmacy': 'Pharmacy',
    'shops.categories.electronics': 'Electronics',
    'shops.categories.bakery': 'Bakery',
    'shops.categories.freshBazaar': 'Fresh Bazaar',
    'shops.badge.fastDelivery': 'Fast Delivery',
    'shops.badge.discount': 'Discount Available',
    'shops.badge.popular': 'Popular',
    'location.confirm.title': 'Confirm Your Location',
    'location.confirm.near': 'Near:',
    'location.confirm.instructions': 'Add delivery instructions (optional)',
    'location.confirm.instructionsPlaceholder': 'e.g., Blue gate, 2nd floor',
    'location.confirm.confirmButton': 'CONFIRM & CONTINUE',
    'location.confirm.changeLocation': 'Change Location',
    'delivery.title': 'Delivery',
    'delivery.pickFrom': 'Pick From',
    'delivery.deliverTo': 'Deliver To',
    'delivery.enterAddress': 'Enter Address',
    'delivery.getFare': 'Get Fare',
    'delivery.searchPlaceholder': 'Search location...',
    'delivery.pickFromTitle': 'Pick From',
    'delivery.deliverToTitle': 'Deliver To',
    'delivery.enterBothAddresses': 'Enter both addresses to continue',
    'shop.delivery': 'Delivery',
    'shop.deliveryTime': 'Delivery in',
    'shop.deliveryFee': 'delivery',
    'shop.searchPlaceholder': 'Search products...',
    'shop.categories': 'Categories',
    'shop.sale': 'Sale',
    'shop.addToCart': 'Add to Cart',
    'shop.items': 'items',
    'shop.item': 'item',
    'shop.checkout': 'Checkout',
    'shop.cart.title': 'Your Cart',
    'shop.cart.orderingFrom': 'Ordering from',
    'shop.cart.selectedShop': 'Selected shop',
    'shop.cart.standardDelivery': 'Standard delivery • 20-30 mins',
    'shop.cart.remove': 'Remove',
    'shop.cart.addMore': '+ Add more items',
    'shop.cart.subtotal': 'Subtotal',
    'shop.cart.deliveryFee': 'Delivery fee',
    'shop.cart.total': 'Total',
    'shop.cart.confirmPayment': 'Confirm payment & address',
    'shop.checkout.title': 'Checkout',
    'shop.checkout.menu': 'Menu',
    'shop.checkout.cart': 'Cart',
    'shop.checkout.deliveryAddress': 'Delivery address',
    'shop.checkout.addInstruction': 'Add delivery instruction',
    'shop.checkout.contactless': 'Contactless delivery',
    'shop.checkout.tipRider': 'Tip your rider',
    'shop.checkout.tipInfo': '100% tip goes to your rider',
    'shop.checkout.notNow': 'Not now',
    'shop.checkout.orderTotal': 'Order total',
    'shop.checkout.tip': 'Tip',
    'shop.checkout.totalPayable': 'Total payable',
    'shop.checkout.paying': 'Paying',
    'shop.checkout.placeOrder': 'Place order',
    'booking.fareBreakdown': 'FARE BREAKDOWN',
    'booking.baseFare': 'Base Fare',
    'booking.distanceCharge': 'Distance charge (5 km)',
    'booking.timeCharge': 'Time charge (12 min)',
    'booking.subtotal': 'Subtotal',
    'booking.discount': 'Promo discount',
    'booking.totalFare': 'Total Fare',
    'booking.payment': 'Payment',
    'booking.discountBanner': 'discount applied',
    'booking.payAfterRide': 'You will pay AFTER the ride completes',
    'booking.fasterPickup': 'faster pickup',
    'booking.longerWait': 'longer wait',
  },
  ur: {
    'language.toggle': 'EN',
    'language.selectTitle': 'اپنی زبان منتخب کریں',
    'language.selectSubtitle': 'اپنی پسندیدہ زبان چنیں',
    'language.englishDescription': 'انگریزی میں جاری رکھیں',
    'language.urduDescription': 'اردو میں جاری رکھیں',
    'language.continue': 'جاری رکھیں',
    'home.promo.title': 'ازکا عقیل، اپنی اگلی کار سواری پر 30٪ رعایت حاصل کریں!',
    'home.promo.subtitle': 'صرف آپ کے لئے محدود وقت کی آفر',
    'home.location.pickupLabel': 'پک اپ مقام',
    'home.location.dropoffLabel': 'ڈراپ آف مقام',
    'home.location.skip': 'کرایہ پر جائیں',
    'home.locateMe': 'مجھے تلاش کریں',
    'nav.ride': 'سواری',
    'nav.delivery': 'ڈیلیوری',
    'nav.shops': 'دکانیں',
    'location.recent': 'حالیہ',
    'location.map': 'نقشہ',
    'location.area': 'علاقہ',
    'location.useCurrent': 'موجودہ مقام استعمال کریں',
    'location.savedAddresses': 'محفوظ پتے',
    'location.home': 'گھر',
    'location.work': 'کام',
    'location.addNew': 'نیا پتہ شامل کریں',
    'location.recentLocations': 'حالیہ مقامات',
    'location.currentLocation': 'موجودہ مقام',
    'location.searchPlaceholder': 'پک اپ',
    'location.from': 'سے',
    'location.to': 'تک',
    'location.areas.karachi': 'کراچی',
    'location.areas.surjaniTown': 'سورجانی ٹاؤن',
    'location.areas.newKarachi': 'نیو کراچی',
    'location.areas.northNazimabad': 'نارتھ ناظم آباد',
    'location.areas.fbArea': 'ایف بی ایریا',
    'location.areas.gulshanMaymar': 'گلشن معمار',
    'location.areas.sohrabGoth': 'سہراب گوٹھ',
    'location.areas.scheme33': 'سکیم 33',
    'location.areas.gulistanJohar': 'گلستان جوہر',
    'location.areas.malirAirport': 'ملیر اور ایئرپورٹ',
    'location.areas.landhi': 'لانڈھی',
    'location.areas.shahFaisalTown': 'شاہ فیصل ٹاؤن',
    'location.areas.korangi': 'کورنگی',
    'location.areas.paf': 'پی اے ایف',
    'location.areas.mehmoodabad': 'محمود آباد',
    'location.areas.qayyumabad': 'قیوم آباد',
    'location.recent.fastUniversity': 'فاسٹ یونیورسٹی، کراچی',
    'location.recent.centaurusMall': 'سینٹارس مال، اسلام آباد',
    'location.recent.jinnahSuperMarket': 'جناح سپر مارکیٹ، کراچی',
    'parcel.title': 'پارسل کی تفصیلات',
    'parcel.deliveryRoute': 'ڈیلیوری روٹ',
    'parcel.parcelInfo': 'پارسل کی معلومات',
    'parcel.weight': 'وزن (کلوگرام)',
    'parcel.weightPlaceholder': 'مثال: 2.5',
    'parcel.dimensions': 'جہتیں (لمبائی x چوڑائی x اونچائی سینٹی میٹر)',
    'parcel.dimensionsPlaceholder': 'مثال: 30 x 20 x 15',
    'parcel.description': 'تفصیل',
    'parcel.descriptionPlaceholder': 'پیکج میں کیا ہے؟',
    'parcel.recipientDetails': 'وصول کنندہ کی تفصیلات',
    'parcel.name': 'نام',
    'parcel.namePlaceholder': 'وصول کنندہ کا مکمل نام',
    'parcel.phone': 'فون نمبر',
    'parcel.phonePlaceholder': '03XX-XXXXXXX',
    'parcel.cod': 'ادائیگی وصولی',
    'parcel.codDesc': 'وصول کنندہ سے ادائیگی وصول کریں',
    'parcel.codAmount': 'وصول کرنے والی رقم (روپے)',
    'parcel.codAmountPlaceholder': 'مثال: 5000',
    'parcel.placeOrder': 'آرڈر دیں',
    'parcel.required': 'براہ کرم تمام ضروری فیلڈز بھریں',
    'shops.nearby': 'قریبی دکانیں',
    'shops.searchPlaceholder': 'دکانیں یا مصنوعات تلاش کریں',
    'shops.popular': 'آپ کے قریب مشہور',
    'shops.orderAgain': 'دوبارہ آرڈر کریں',
    'shops.categories.groceries': 'کریانہ',
    'shops.categories.pharmacy': 'دواخانہ',
    'shops.categories.electronics': 'الیکٹرانکس',
    'shops.categories.bakery': 'بیکری',
    'shops.categories.freshBazaar': 'تازہ بازار',
    'shops.badge.fastDelivery': 'تیز ڈیلیوری',
    'shops.badge.discount': 'رعایت دستیاب',
    'shops.badge.popular': 'مشہور',
    'location.confirm.title': 'اپنا مقام تصدیق کریں',
    'location.confirm.near': 'قریب:',
    'location.confirm.instructions': 'ڈیلیوری کی ہدایات شامل کریں (اختیاری)',
    'location.confirm.instructionsPlaceholder': 'مثال: نیلا گیٹ، دوسری منزل',
    'location.confirm.confirmButton': 'تصدیق کریں اور جاری رکھیں',
    'location.confirm.changeLocation': 'مقام تبدیل کریں',
    'delivery.title': 'ڈیلیوری',
    'delivery.pickFrom': 'یہاں سے اٹھائیں',
    'delivery.deliverTo': 'یہاں ڈیلیور کریں',
    'delivery.enterAddress': 'پتہ درج کریں',
    'delivery.getFare': 'کرایہ حاصل کریں',
    'delivery.searchPlaceholder': 'مقام تلاش کریں...',
    'delivery.pickFromTitle': 'یہاں سے اٹھائیں',
    'delivery.deliverToTitle': 'یہاں ڈیلیور کریں',
    'delivery.enterBothAddresses': 'جاری رکھنے کے لئے دونوں پتے درج کریں',
    'shop.delivery': 'ڈیلیوری',
    'shop.deliveryTime': 'ڈیلیوری',
    'shop.deliveryFee': 'ڈیلیوری',
    'shop.searchPlaceholder': 'مصنوعات تلاش کریں...',
    'shop.categories': 'اقسام',
    'shop.sale': 'سیل',
    'shop.addToCart': 'ٹوکری میں شامل کریں',
    'shop.items': 'اشیاء',
    'shop.item': 'شے',
    'shop.checkout': 'چیک آؤٹ',
    'shop.cart.title': 'آپ کی ٹوکری',
    'shop.cart.orderingFrom': 'آرڈر کر رہے ہیں',
    'shop.cart.selectedShop': 'منتخب دکان',
    'shop.cart.standardDelivery': 'معیاری ڈیلیوری • 20-30 منٹ',
    'shop.cart.remove': 'ہٹائیں',
    'shop.cart.addMore': '+ مزید اشیاء شامل کریں',
    'shop.cart.subtotal': 'ذیلی مجموعہ',
    'shop.cart.deliveryFee': 'ڈیلیوری فیس',
    'shop.cart.total': 'کل',
    'shop.cart.confirmPayment': 'ادائیگی اور پتہ تصدیق کریں',
    'shop.checkout.title': 'چیک آؤٹ',
    'shop.checkout.menu': 'مینو',
    'shop.checkout.cart': 'ٹوکری',
    'shop.checkout.deliveryAddress': 'ڈیلیوری کا پتہ',
    'shop.checkout.addInstruction': 'ڈیلیوری کی ہدایت شامل کریں',
    'shop.checkout.contactless': 'بغیر رابطے کی ڈیلیوری',
    'shop.checkout.tipRider': 'اپنے رائیڈر کو ٹپ دیں',
    'shop.checkout.tipInfo': '100% ٹپ آپ کے رائیڈر کو جاتی ہے',
    'shop.checkout.notNow': 'ابھی نہیں',
    'shop.checkout.orderTotal': 'آرڈر کی کل رقم',
    'shop.checkout.tip': 'ٹپ',
    'shop.checkout.totalPayable': 'کل قابل ادائیگی',
    'shop.checkout.paying': 'ادائیگی',
    'shop.checkout.placeOrder': 'آرڈر دیں',
    'booking.fareBreakdown': 'کرایہ کی تفصیل',
    'booking.baseFare': 'بنیادی کرایہ',
    'booking.distanceCharge': 'فاصلہ چارج (۵ کلومیٹر)',
    'booking.timeCharge': 'وقت چارج (۱۲ منٹ)',
    'booking.subtotal': 'ذیلی مجموعہ',
    'booking.discount': 'پرومو رعایت',
    'booking.totalFare': 'مکمل کرایہ',
    'booking.payment': 'ادائیگی',
    'booking.discountBanner': 'رعایت لاگو',
    'booking.payAfterRide': 'آپ سواری مکمل ہونے کے بعد ادائیگی کریں گے',
    'booking.fasterPickup': 'تیز پک اپ',
    'booking.longerWait': 'زیادہ انتظار',
  },
};

interface LanguageContextValue {
  language: Language;
  setLanguage: (lang: Language) => void;
  toggleLanguage: () => void;
  t: (key: string, fallback?: string) => string;
}

const LanguageContext = createContext<LanguageContextValue | null>(null);

interface ProviderProps {
  children: ReactNode;
}

export function LanguageProvider({ children }: ProviderProps) {
  const [language, setLanguage] = useState<Language>(() => {
    if (typeof window === 'undefined') {
      return 'en';
    }
    const stored = window.localStorage.getItem('hci-language');
    return stored === 'ur' ? 'ur' : 'en';
  });

  useEffect(() => {
    if (typeof window !== 'undefined') {
      window.localStorage.setItem('hci-language', language);
    }
  }, [language]);

  const value = useMemo<LanguageContextValue>(() => {
    const toggleLanguage = () => setLanguage((prev) => (prev === 'en' ? 'ur' : 'en'));
    const t = (key: string, fallback?: string) => translations[language][key] ?? fallback ?? key;
    return { language, setLanguage, toggleLanguage, t };
  }, [language]);

  return <LanguageContext.Provider value={value}>{children}</LanguageContext.Provider>;
}

export function useTranslation() {
  const context = useContext(LanguageContext);
  if (!context) {
    throw new Error('useTranslation must be used within a LanguageProvider');
  }
  return context;
}

